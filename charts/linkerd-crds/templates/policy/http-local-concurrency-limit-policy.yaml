---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: httplocalconcurrencylimitpolicies.policy.linkerd.io
  annotations:
    {{ include "partials.annotations.created-by" . }}
  labels:
    helm.sh/chart: {{ .Chart.Name }}-{{ .Chart.Version | replace "+" "_" }}
    linkerd.io/control-plane-ns: {{.Release.Namespace}}
spec:
  group: policy.linkerd.io
  names:
    kind: HTTPLocalConcurrencyLimitPolicy
    listKind: HTTPLocalConcurrencyLimitPolicyList
    plural: httplocalconcurrencylimitpolicies
    singular: httplocalconcurrencylimitpolicy
  scope: Namespaced
  versions:
    - name: v1alpha1
      served: true
      storage: true
      subresources:
        status: {}
      schema:
        openAPIV3Schema:
          type: object
          required: [spec]
          properties:
            spec:
              type: object
              required: [targetRef, maxInFlightRequests]
              properties:
                targetRef:
                  description: >-
                    TargetRef references a resource to which the concurrency limit
                    policy applies. Only Server is allowed.
                  type: object
                  required: [kind, name]
                  properties:
                    group:
                      description: >-
                        Group is the group of the referent. When empty, the
                        Kubernetes core API group is inferred.
                      maxLength: 253
                      pattern: ^$|^[a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*$
                      type: string
                    kind:
                      description: Kind is the kind of the referent.
                      maxLength: 63
                      minLength: 1
                      pattern: ^[a-zA-Z]([-a-zA-Z0-9]*[a-zA-Z0-9])?$
                      type: string
                    name:
                      description: Name is the name of the referent.
                      maxLength: 253
                      minLength: 1
                      type: string
                maxInFlightRequests:
                  description: >-
                    Maximum number of concurrent in-flight requests allowed for
                    this server. When this limit is reached, new requests will be
                    rejected with HTTP 503 Service Unavailable.
                  type: integer
                  format: int32
                  minimum: 1
            status:
              type: object
              properties:
                conditions:
                  type: array
                  items:
                    type: object
                    properties:
                      lastTransitionTime:
                        description: lastTransitionTime is the last time the
                          condition transitioned from one status to another.
                        format: date-time
                        type: string
                      status:
                        description: status of the condition (one of True, False, Unknown)
                        enum:
                        - "True"
                        - "False"
                        - Unknown
                        type: string
                      type:
                        description: type of the condition in CamelCase or in
                          foo.example.com/CamelCase.
                        maxLength: 316
                        pattern: ^([a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*/)?(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])$
                        type: string
                      reason:
                        description: reason contains a programmatic identifier
                          indicating the reason for the condition's last
                          transition. Producers of specific condition types may
                          define expected values and meanings for this field, and
                          whether the values are considered a guaranteed API. The
                          value should be a CamelCase string. This field may not
                          be empty.
                        maxLength: 1024
                        minLength: 1
                        pattern: ^[A-Za-z]([A-Za-z0-9_,:]*[A-Za-z0-9_])?$
                        type: string
                      message:
                        description: message is a human readable message
                          indicating details about the transition. This may be an
                          empty string.
                        maxLength: 32768
                        type: string
                  required:
                  - status
                  - type
                targetRef:
                  properties:
                    group:
                      default: policy.linkerd.io
                      maxLength: 253
                      pattern: ^$|^[a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*$
                      type: string
                    kind:
                      default: Server
                      maxLength: 63
                      minLength: 1
                      pattern: ^[a-zA-Z]([-a-zA-Z0-9]*[a-zA-Z0-9])?$
                      type: string
                    name:
                      maxLength: 253
                      minLength: 1
                      type: string
                  required:
                  - name
                  type: object
              required:
              - targetRef
      additionalPrinterColumns:
      - name: Target_kind
        description: The resource kind to which the concurrency-limit applies
        type: string
        jsonPath: .spec.targetRef.kind
      - name: Target_name
        type: string
        description: The resource name to which the concurrency-limit applies
        jsonPath: .spec.targetRef.name
      - name: Max_In_Flight
        description: The maximum number of concurrent in-flight requests
        type: integer
        format: int32
        jsonPath: .spec.maxInFlightRequests
