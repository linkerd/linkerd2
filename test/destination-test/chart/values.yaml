# Default values for dst-load-test
# This Helm chart deploys load testing controllers for Linkerd's destination service

# Docker image configuration
image:
  repository: dst-load-controller
  tag: latest
  pullPolicy: Never  # Use local image imported into k3d

# Image pull secrets (if needed for private registries)
imagePullSecrets: []

# Service account configuration
serviceAccount:
  create: true
  name: dst-load-test

# RBAC permissions
rbac:
  create: true

# Namespace where test services will be created
testNamespace: dst-test

# Test services configuration (created by Helm chart)
testServices:
  # Number of services to create
  count: 10
  
  # Service name prefix (will create {namePrefix}-0, {namePrefix}-1, etc.)
  namePrefix: test-svc
  
  # Initial replica count for each Deployment
  initialReplicas: 100
  
  # Service port
  port: 8080

# Multicluster configuration (optional)
multicluster:
  # Enable multicluster annotations on services
  enabled: false
  
  # Additional annotations for multicluster services
  # Example: config.linkerd.io/enable-gateway: "true"
  annotations: {}

# Churn controller configuration
churn:
  enabled: true
  
  # Deployment name pattern to scale (supports wildcards)
  deploymentPattern: "test-svc-*"
  
  # Oscillation configuration
  minReplicas: 10
  maxReplicas: 200
  holdDuration: "30s"
  jitterPercent: 10
  
  # Metrics server port
  metricsPort: 8080
  
  # Resource limits
  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 500m
      memory: 256Mi

# Client controller configuration
client:
  enabled: false
  
  # Number of client replicas
  replicas: 1
  
  # Image configuration (overrides global image settings if specified)
  image:
    repository: dst-load-controller
    tag: latest
    pullPolicy: Never
  
  # Destination service address
  destinationAddr: linkerd-dst-headless.linkerd.svc.cluster.local:8086
  
  # Label selector for discovering services to watch
  # Example: "dst-load.l5d.io/role=target" for load test targets
  serviceLabelSelector: "dst-load.l5d.io/role=target"
  
  # Number of concurrent watchers per discovered service
  watchersPerService: 10
  
  # Stream lifetime configuration
  # Minimum time before reconnecting (with jitter)
  minStreamLifetime: "5m"
  # Maximum time before reconnecting (with jitter)
  maxStreamLifetime: "30m"
  
  # Metrics server port
  metricsPort: 8080
  
  # Resource limits
  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 500m
      memory: 256Mi

# Pod annotations (for Linkerd injection)
podAnnotations:
  linkerd.io/inject: enabled
  config.linkerd.io/skip-outbound-ports: "8080"  # Skip metrics port

# Node selector
nodeSelector: {}

# Tolerations
tolerations: []

# Affinity
affinity: {}
