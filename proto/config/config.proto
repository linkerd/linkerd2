syntax = "proto3";

package linkerd2.config;

option go_package = "github.com/linkerd/linkerd2/controller/gen/config";

// ConfigStore provides an abstraction over the underlying configuration storge.
service ConfigStore {
  // Return the global config.
  rpc GetGlobalConfig(GetParam) returns (GlobalConfig) {}

  // Return the proxy config.
  rpc GetProxyConfig(GetParam) returns (ProxyConfig) {}

  // Set the global config. It overwrites the existing value.
  rpc SetGlobalConfig(GlobalConfig) returns (Result) {}

  // Set the proxy config. It overwrites the existing value.
  rpc SetProxyConfig(ProxyConfig) returns (Result) {}
}

message GlobalConfig {
  string linkerd_namespace = 1;
  bool cni_enabled = 2;
  bool tls_enabled = 3;
}

message ProxyConfig {
  Image proxy_image = 1;
  Image proxy_init_image = 2;

  Port api_port = 3;
  Port control_port = 4;
  repeated Port ignore_inbound_ports = 5;
  repeated Port ignore_outbound_ports = 6;
  Port inbound_port = 7;
  Port metrics_port = 8;
  Port outbound_port = 9;

  ResourceRequirements resource = 10;

  TLS tls_enabled = 11;

  int64 proxy_uid = 12;
  LogLevel log_level = 13;
  bool disable_external_profiles = 14;
}

message Image {
  string image_name = 1;
  string pull_policy = 2;
  string registry = 3;
}

message Port {
  uint32 port = 1;
}

message ResourceRequirements {
  float request_cpu = 1;
  float request_memory = 2;
}

message LogLevel {
  string level = 1;
}

enum TLS {
  NONE = 0;
  OPTIONAL = 1;
}

message CNI {
  Image image = 1;
  LogLevel log_level = 2;
  Port control_port = 3;

  string dest_cni_bin_dir = 4;
  string dest_cni_net_dir = 5;

  ProxyConfig proxy_config = 6;
}

message GetParam{}

message Result {
  string msg = 1;
  bool is_error = 2;
}
