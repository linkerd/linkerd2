{{if .Values.gateway.enabled -}}
---
apiVersion: policy.linkerd.io/v1alpha1
kind: Server
metadata:
  namespace: {{.Values.namespace}}
  name: linkerd-gateway
  labels:
    linkerd.io/extension: multicluster
    app: {{.Values.gateway.name}}
  annotations:
    {{ include "partials.annotations.created-by" . }}
spec:
  podSelector:
    matchLabels:
      app: {{.Values.gateway.name}}
  port: linkerd-proxy
  proxyProtocol: TLS
---
apiVersion: policy.linkerd.io/v1alpha1
kind: ServerAuthorization
metadata:
  namespace: {{.Values.namespace}}
  name: linkerd-gateway
  labels:
    linkerd.io/extension: multicluster
    app: {{.Values.gateway.name}}
  annotations:
    {{ include "partials.annotations.created-by" . }}
spec:
  server:
    name: linkerd-gateway
  client:
    meshTLS:
      identities:
      - '*'
{{- $tree := deepCopy . }}
{{ $_ := set $tree.Values "component" "linkerd-gateway" -}}
{{ $val := .Values.gateway.name }}
{{ $_ := set $tree.Values "labels" (dict "app" $val) -}}
{{ include "partials.ext-proxy-admin-policy" $tree }}
{{end -}}
